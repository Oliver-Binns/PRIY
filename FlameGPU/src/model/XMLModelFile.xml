<?xml version="1.0" encoding="utf-8"?>
<gpu:xmodel xmlns:gpu="http://www.dcs.shef.ac.uk/~paul/XMMLGPU" xmlns="http://www.dcs.shef.ac.uk/~paul/XMML">
	<name>PPSim</name>
	
	<gpu:environment>
		<gpu:constants>
			<gpu:variable>
				<type>int</type>
				<name>LTI_AGENT_TYPE</name>
				<description>Int ID as enum for LTi cells</description>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>LTIN_AGENT_TYPE</name>
				<description>Int ID as enum for LTin cells</description>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>LTO_AGENT_TYPE</name>
				<description>Int ID as enum for LTo cells</description>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>LTI_CELL_SIZE</name>
				<description>Diameter of the LTin and LTi cells</description>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>LTO_CELL_SIZE</name>
				<description>Diameter of the LTo cells</description>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>ADHESION_DISTANCE_THRESHOLD</name>
				<description>(lti_cell_size + lto_cell_size) / 2 : Used for calculating the distance between cells to determine adhesion</description>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>CHEMO_THRESHOLD</name>
				<description>Chemokine Threshold, must be in the range 0-1</description>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>CHEMO_CURVE_ADJUST</name>
				<description>Sigmoid Curve Adjustment</description>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>CHEMO_UPPER_ADJUST</name>
				<description>Initial Curve Value</description>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>CHEMO_LOWER_ADJUST</name>
				<description>Lower Curve Value</description>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>INCREASE_CHEMO_EXPRESSION</name>
				<description>Increase in expression with stable contact</description>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>INITIAL_ADHESION</name>
				<description>Initial expression of Adhesion Factors</description>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>ADHESION_SLOPE</name>
				<description>Linear Equation Slope</description>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>ADHESION_INCREMENT</name>
				<description>Increase in Adhesion with each stable contact</description>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>MAX_ADHESION_PROBABILITY</name>
				<description>Adhesion Level Threshold</description>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>MAX_CELL_SPEED</name>
				<description>The maximum number of pixels that a cell can move in a single iteration</description>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>CIRCUMFERENCE</name>
				<description>Circumference of the Gut</description>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>LENGTH</name>
				<description>Length of the Gut</description>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>STROMAL_CELL_DENSITY</name>
				<description></description>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>PERCENT_LTIN_FROM_FACS</name>
				<description>Percentage of area occupied by LTin cells at E15.5</description>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>PERCENT_LTI_FROM_FACS</name>
				<description>Percentage of area occupied by LTi cells at E15.5</description>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>SIM_STEP</name>
				<description>The current step of the simulation.</description>
			</gpu:variable>
		</gpu:constants>
		<gpu:functionFiles>
				<file>functions.c</file>
		</gpu:functionFiles>
		<gpu:initFunctions>
			<gpu:initFunction>
				<gpu:name>setConstants</gpu:name>
			</gpu:initFunction>
		</gpu:initFunctions>
		<gpu:stepFunctions>
			<gpu:stepFunction>
				<gpu:name>migrateNewCells</gpu:name>
			</gpu:stepFunction>
		</gpu:stepFunctions>
	</gpu:environment>
	
	<xagents>
		<gpu:xagent>
			<name>LTin</name>
			<description></description>
			<memory>
				<gpu:variable>
					<type>float</type>
					<name>x</name>
				</gpu:variable>
				<gpu:variable>
					<type>float</type>
					<name>y</name>
				</gpu:variable>
				<gpu:variable>
					<type>float</type>
					<name>velocity</name>
				</gpu:variable>
				<gpu:variable>
					<type>int</type>
					<name>colour</name>
				</gpu:variable>
				<gpu:variable>
					<type>int</type>
					<name>stable_contact</name>
				</gpu:variable>
			</memory>
			<functions>
				<gpu:function>
					<name>ltin_adhesion</name>
					<currentState>ltin_random_movement</currentState>
					<nextState>localised_movement</nextState>
						<condition><lhs><value>1.0</value></lhs><operator>==</operator><rhs><value>stable_contact</value></rhs></condition>
					<gpu:reallocate>true</gpu:reallocate>
					<gpu:RNG>true</gpu:RNG>
				</gpu:function>
				<gpu:function>
					<name>ltin_random_move</name>
					<currentState>ltin_random_movement</currentState>
					<nextState>ltin_random_movement</nextState>
					<inputs>
						<gpu:input>
							<messageName>location</messageName>
						</gpu:input>
					</inputs>
					<gpu:reallocate>true</gpu:reallocate>
					<gpu:RNG>true</gpu:RNG>
				</gpu:function>
				<gpu:function>
					<name>ltin_localised_move</name>
					<currentState>localised_movement</currentState>
					<nextState>localised_movement</nextState>
					<gpu:reallocate>true</gpu:reallocate>
					<gpu:RNG>true</gpu:RNG>
				</gpu:function>
			</functions>
			<states>
				<gpu:state>
					<name>ltin_random_movement</name>
				</gpu:state>
				<gpu:state>
					<name>localised_movement</name>
				</gpu:state>
				<initialState>ltin_random_movement</initialState>
			</states>
			<gpu:type>continuous</gpu:type>
			<gpu:bufferSize>1024</gpu:bufferSize>
		</gpu:xagent>
		<gpu:xagent>
			<name>LTi</name>
			<description></description>
			<memory>
				<gpu:variable>
					<type>float</type>
					<name>x</name>
				</gpu:variable>
				<gpu:variable>
					<type>float</type>
					<name>y</name>
				</gpu:variable>
				<gpu:variable>
					<type>float</type>
					<name>velocity</name>
				</gpu:variable>
				<gpu:variable>
					<type>int</type>
					<name>colour</name>
				</gpu:variable>
			</memory>
			<functions>
				<gpu:function>
					<name>lti_random_move</name>
					<currentState>lti_random_movement</currentState>
					<nextState>lti_random_movement</nextState>
					<gpu:reallocate>true</gpu:reallocate>
					<gpu:RNG>true</gpu:RNG>
				</gpu:function>
			</functions>
			<states>
				<gpu:state>
					<name>lti_random_movement</name>
				</gpu:state>
				<gpu:state>
					<name>responding</name>
				</gpu:state>
				<gpu:state>
					<name>contact</name>
				</gpu:state>
				<gpu:state>
					<name>adhesion</name>
				</gpu:state>
				<initialState>lti_random_movement</initialState>
			</states>
			<gpu:type>continuous</gpu:type>
			<gpu:bufferSize>1024</gpu:bufferSize>
		</gpu:xagent>
		<gpu:xagent>
			<name>LTo</name>
			<description></description>
			<memory>
				<gpu:variable>
					<type>float</type>
					<name>x</name>
				</gpu:variable>
				<gpu:variable>
					<type>float</type>
					<name>y</name>
				</gpu:variable>
				<gpu:variable>
					<type>int</type>
					<name>colour</name>
				</gpu:variable>
			</memory>
			<functions>
				<gpu:function>
					<name>express</name>
					<currentState>expression</currentState>
					<nextState>expression</nextState>
					<outputs>
						<gpu:output>
							<messageName>location</messageName>
							<gpu:type>single_message</gpu:type>
						</gpu:output>
					</outputs>
					<gpu:reallocate>false</gpu:reallocate>
					<gpu:RNG>false</gpu:RNG>
				</gpu:function>
				<gpu:function>
					<name>divide</name>
					<currentState>expression</currentState>
					<nextState>resolve</nextState>
					<xagentOutputs>
						<gpu:xagentOutput>
							<xagentName>LTo</xagentName>
							<state>expression</state>
						</gpu:xagentOutput>
					</xagentOutputs>
						<condition><lhs><value>0.0</value></lhs><operator>==</operator><rhs><condition><lhs><value>SIM_STEP</value></lhs><operator>%</operator><rhs><value>720.0</value></rhs></condition></rhs></condition>
					<gpu:reallocate>false</gpu:reallocate>
					<gpu:RNG>false</gpu:RNG>
				</gpu:function>
				<gpu:function>
					<name>resolve</name>
					<currentState>resolve</currentState>
					<nextState>resolve</nextState>
					<inputs>
						<gpu:input>
							<messageName>force</messageName>
						</gpu:input>
					</inputs>
					<gpu:reallocate></gpu:reallocate>
					<gpu:RNG></gpu:RNG>
				</gpu:function>
				<gpu:function>
					<name>resolved</name>
					<currentState>resolve</currentState>
					<nextState>expression</nextState>
					<gpu:reallocate></gpu:reallocate>
					<gpu:RNG></gpu:RNG>
				</gpu:function>
				<gpu:function>
					<name>output_force</name>
					<currentState>resolve</currentState>
					<nextState>resolve</nextState>
					<outputs>
						<gpu:output>
							<messageName>force</messageName>
							<gpu:type>single_message</gpu:type>
						</gpu:output>
					</outputs>
					<gpu:reallocate></gpu:reallocate>
					<gpu:RNG></gpu:RNG>
				</gpu:function>
			</functions>
			<states>
				<gpu:state>
					<name>expression</name>
				</gpu:state>
				<gpu:state>
					<name>adhesion_upregulation</name>
				</gpu:state>
				<gpu:state>
					<name>chemokine_upregulation</name>
				</gpu:state>
				<gpu:state>
					<name>mature</name>
				</gpu:state>
				<gpu:state>
					<name>downregulated</name>
				</gpu:state>
				<gpu:state>
					<name>resolve</name>
				</gpu:state>
				<initialState>expression</initialState>
			</states>
			<gpu:type>continuous</gpu:type>
			<gpu:bufferSize>1024</gpu:bufferSize>
		</gpu:xagent>
	</xagents>
	
	<messages>
		<gpu:message>
			<name>location</name>
			<description>A message holding the type and location of a cell</description>
			<variables>
				<gpu:variable>
					<type>float</type>
					<name>x</name>
				</gpu:variable>
				<gpu:variable>
					<type>float</type>
					<name>y</name>
				</gpu:variable>
				<gpu:variable>
					<type>float</type>
					<name>z</name>
				</gpu:variable>
				<gpu:variable>
					<type>int</type>
					<name>cell_type</name>
				</gpu:variable>
			</variables>
			<gpu:partitioningSpatial>
				<gpu:radius>4</gpu:radius>
				<gpu:xmin>0</gpu:xmin>
				<gpu:xmax>7304</gpu:xmax>
				<gpu:ymin>0</gpu:ymin>
				<gpu:ymax>256</gpu:ymax>
				<gpu:zmin>0</gpu:zmin>
				<gpu:zmax>4</gpu:zmax>
			</gpu:partitioningSpatial>
			<gpu:bufferSize>1024</gpu:bufferSize>
		</gpu:message>
		<gpu:message>
			<name>force</name>
			<description></description>
			<variables>
				<gpu:variable>
					<type>int</type>
					<name>x</name>
				</gpu:variable>
				<gpu:variable>
					<type>int</type>
					<name>y</name>
				</gpu:variable>
				<gpu:variable>
					<type>int</type>
					<name>z</name>
				</gpu:variable>
			</variables>
			<gpu:partitioningSpatial>
				<gpu:radius>4</gpu:radius>
				<gpu:xmin>0</gpu:xmin>
				<gpu:xmax>7304</gpu:xmax>
				<gpu:ymin>0</gpu:ymin>
				<gpu:ymax>256</gpu:ymax>
				<gpu:zmin>0</gpu:zmin>
				<gpu:zmax>4</gpu:zmax>
			</gpu:partitioningSpatial>
			<gpu:bufferSize>1024</gpu:bufferSize>
		</gpu:message>
	</messages>
	
	<layers>
		<layer>
			<gpu:layerFunction>
				<name>express</name>
			</gpu:layerFunction>
		</layer>
		<layer>
			<gpu:layerFunction>
				<name>lti_random_move</name>
			</gpu:layerFunction>
			<gpu:layerFunction>
				<name>ltin_random_move</name>
			</gpu:layerFunction>
		</layer>
		<layer>
			<gpu:layerFunction>
				<name>ltin_adhesion</name>
			</gpu:layerFunction>
			<gpu:layerFunction>
				<name>divide</name>
			</gpu:layerFunction>
		</layer>
		<layer>
		</layer>
		<layer>
		</layer>
	</layers>
</gpu:xmodel>

