<?xml version="1.0" encoding="utf-8"?>
<gpu:xmodel xmlns:gpu="http://www.dcs.shef.ac.uk/~paul/XMMLGPU" xmlns="http://www.dcs.shef.ac.uk/~paul/XMML">

	<name>PPSim</name>

	<gpu:environment>
		<gpu:constants>
			<!--Enumeration of Cell Types-->
			<gpu:variable>
				<type>int</type>
				<name>LTI_AGENT_TYPE</name>
				<description>Int ID as enum for LTi cells</description>
				<defaultValue>0</defaultValue>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>LTIN_AGENT_TYPE</name>
				<description>Int ID as enum for LTin cells</description>
				<defaultValue>1</defaultValue>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>LTO_AGENT_TYPE</name>
				<description>Int ID as enum for LTo cells</description>
				<defaultValue>2</defaultValue>
			</gpu:variable>
			<!-- Cell Sizes -->
			<gpu:variable>
				<type>int</type>
				<name>LTI_CELL_SIZE</name>
				<description>Diameter of the LTin and LTi cells</description>
				<defaultValue>6</defaultValue>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>LTO_CELL_SIZE</name>
				<description>Diameter of the LTo cells</description>
				<defaultValue>2</defaultValue>
			</gpu:variable>
			<gpu:variable>
				<type>int</type>
				<name>adhesion_distance_threshold</name>
				<description>(lti_cell_size + lto_cell_size) / 2 : Used for calculating the distance between cells to determine adhesion</description>
				<defaultValue>4</defaultValue>
			</gpu:variable>
  		<!--
            Calibrated Values:
            MODELLING CHEMOKINES
        -->
        <gpu:variable>
        	<type>float</type>
        	<name>CHEMO_THRESHOLD</name>
        	<description>Chemokine Threshold, must be in the range 0-1</description>
        	<defaultValue>0.3</defaultValue>
        </gpu:variable>
        <gpu:variable>
        	<type>int</type>
        	<name>CHEMO_CURVE_ADJUST</name>
        	<description>Sigmoid Curve Adjustment</description>
        	<defaultValue>3</defaultValue>
        </gpu:variable>
        <gpu:variable>
        	<type>float</type>
        	<name>CHEMO_UPPER_ADJUST</name>
        	<description>Initial Curve Value</description>
        	<defaultValue>0.2</defaultValue>
        </gpu:variable>
        <gpu:variable>
        	<type>float</type>
        	<name>CHEMO_LOWER_ADJUST</name>
        	<description>Lower Curve Value</description>
        	<defaultValue>0.04</defaultValue>
        </gpu:variable>
        <gpu:variable>
        	<type>float</type>
        	<name>INCREASE_CHEMO_EXPRESSION</name>
        	<description>Increase in expression with stable contact</description>
        	<defaultValue>0.005</defaultValue>
        </gpu:variable>
        <!-- 
            MODELLING ADHESION
        -->
        <gpu:variable>
        	<type>float</type>
        	<name>INITIAL_ADHESION</name>
        	<description>Initial expression of Adhesion Factors</description>
        	<defaultValue>0</defaultValue>
        </gpu:variable>
        <gpu:variable>
        	<type>float</type>
        	<name>ADHESION_SLOPE</name>
        	<description>Linear Equation Slope</description>
        	<defaultValue>1</defaultValue>
        </gpu:variable>
        <gpu:variable>
        	<type>float</type>
        	<name>ADHESION_INCREMENT</name>
        	<description>Increase in Adhesion with each stable contact</description>
        	<defaultValue>0.05</defaultValue>
        </gpu:variable>
        <gpu:variable>
        	<type>float</type>
        	<name>MAX_ADHESION_PROBABILITY</name>
        	<description>Adhesion Level Threshold</description>
        	<defaultValue>0.65</defaultValue>
        </gpu:variable>
        <!--
            MODELLING ENVIRONMENT
        -->
        <gpu:variable>
        	<type>int</type>
        	<name>INITIAL_CIRCUMFERENCE</name>
        	<description>Initial Circumference of the Gut</description>
        	<defaultValue>244<!-- Pixels --></defaultValue>
        </gpu:variable>
        <gpu:variable>
        	<type>int</type>
        	<name>MAXIMUM_CIRCUMFERENCE</name>
        	<description>Maximum Circumference of the Gut</description>
        	<defaultValue>254</defaultValue>
        </gpu:variable>
        <gpu:variable>
        	<type>int</type>
        	<name>INITIAL_LENGTH</name>
        	<description>Initial Length of the Gut</description>
        	<defaultValue>7203<!-- Pixels --></defaultValue>
        </gpu:variable>
        <gpu:variable>
        	<type>int</type>
        	<name>MAXIMUM_LENGTH</name>
        	<description>Maximum Length of the Gut</description>
        	<defaultValue>7303</defaultValue>
        </gpu:variable>
        <gpu:variable>
        	<type>float</type>
        	<name>STROMAL_CELL_DENSITY</name>
        	<description>..?</description>
        	<defaultValue>0.2</defaultValue>
        </gpu:variable>
        <gpu:variable>
        	<type>int</type>
        	<name>GROWTH_TIME</name>
        	<description>Intestinal Growth Time (hours)</description>
        	<defaultValue>72</defaultValue>
        </gpu:variable>
        <gpu:variable>
        	<type>float</type>
        	<name>PERCENT_LTIN_FROM_FACS</name>
        	<description>Percentage of area occupied by LTin cells at E15.5</description>
        	<defaultValue>0.45</defaultValue>
        </gpu:variable>
        <gpu:variable>
        	<type>float</type>
        	<name>PERCENT_LTI_FROM_FACS</name>
        	<description>Percentage of area occupied by LTi cells at E15.5</description>
        	<defaultValue>0.37</defaultValue>
        </gpu:variable>
    </gpu:constants>
    <gpu:functionFiles>
    	<file>functions.c</file>
    </gpu:functionFiles>
</gpu:environment>

<xagents>
	<!-- LTin Cells -->
	<gpu:xagent>
		<name>LTin</name>
		<description></description>
		<memory>
			<gpu:variable>
				<type>int</type>
				<name>id</name>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>x</name>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>y</name>
			</gpu:variable>
			<gpu:variable>
				<type>float</type>
				<name>velocity</name>
			</gpu:variable>
		</memory>
		<functions>
			<gpu:function>
				<name>ltin_random_move</name>
				<currentState>ltin_random_movement</currentState>
				<nextState>ltin_random_movement</nextState>
				<gpu:RNG>true</gpu:RNG>
			</gpu:function>

			<gpu:function>
			</functions>
			<states>
				<gpu:state>
					<name>ltin_random_movement</name>
				</gpu:state>
				<gpu:state>
					<name>stable_contact</name>
				</gpu:state>
				<gpu:state>
					<name>localised_movement</name>
				</gpu:state>
				<initialState>ltin_random_movement</initialState>
			</states>
			<gpu:type>continuous</gpu:type>
			<gpu:bufferSize>1024</gpu:bufferSize>
		</gpu:xagent>

		<!-- LTi Cells -->
		<gpu:xagent>
			<name>LTi</name>
			<memory>
				<gpu:variable>
					<type>int</type>
					<name>id</name>
				</gpu:variable>
				<gpu:variable>
					<type>float</type>
					<name>x</name>
				</gpu:variable>
				<gpu:variable>
					<type>float</type>
					<name>y</name>
				</gpu:variable>
				<gpu:variable>
					<type>float</type>
					<name>velocity</name>
				</gpu:variable>
			</memory>
			<functions>
				<gpu:function>
					<name>lti_random_move</name>
					<currentState>lti_random_movement</currentState>
					<nextState>lti_random_movement</nextState>
					<gpu:RNG>true</gpu:RNG>
				</gpu:function>
			</functions>
			<states>
				<gpu:state>
					<name>lti_random_movement</name>
				</gpu:state>
				<gpu:state>
					<name>responding</name>
				</gpu:state>
				<gpu:state>
					<name>contact</name>
				</gpu:state>
				<gpu:state>
					<name>adhesion</name>
				</gpu:state>
				<initialState>lti_random_movement</initialState>
			</states>
			<gpu:type>continuous</gpu:type>
			<gpu:bufferSize>1024</gpu:bufferSize>
		</gpu:xagent>

		<!-- LTo Cells -->
		<gpu:xagent>
			<name>LTo</name>
			<memory>
				<gpu:variable>
					<type>int</type>
					<name>id</name>
				</gpu:variable>
				<gpu:variable>
					<type>float</type>
					<name>x</name>
				</gpu:variable>
				<gpu:variable>
					<type>float</type>
					<name>y</name>
				</gpu:variable>
			</memory>
			<functions>
				<gpu:function>
					<name>express</name>
					<currentState>expression</currentState>
					<nextState>expression</nextState>
					<outputs>
						<gpu:output>
							<messageName>location</messageName>
							<gpu:type>single_message</gpu:type>
						</gpu:output>
					</outputs>
				</gpu:function>
			</functions>
			<states>
				<gpu:state>
					<name>no_expression</name>
				</gpu:state>
				<gpu:state>
					<name>expression</name>
				</gpu:state>
				<gpu:state>
					<name>adhesion_upregulation</name>
				</gpu:state>
				<gpu:state>
					<name>chemokine_upregulation</name>
				</gpu:state>
				<gpu:state>
					<name>mature</name>
				</gpu:state>
				<gpu:state>
					<name>downregulated</name>
				</gpu:state>
				<!-- may be either expression or NO expression??? -->
				<initialState>no_expression</initialState>
			</states>
			<gpu:type>continuous</gpu:type>
			<gpu:bufferSize>1024</gpu:bufferSize>
		</gpu:xagent>
	</xagents>

	<messages>
		<gpu:message>
			<name>location</name>
			<variables>
				<gpu:variable>
					<type>int</type>
					<name>cell_type</name>
				</gpu:variable>
				<gpu:variable>
					<type>float</type>
					<name>x</name>
				</gpu:variable>
				<gpu:variable>
					<type>float</type>
					<name>y</name>
				</gpu:variable>
			</variables>
			<gpu:partitioningDiscrete>
				<gpu:radius>4</gpu:radius>
			</gpu:partitioningDiscrete>
			<gpu:bufferSize>1024</gpu:bufferSize>
		</gpu:message>
	</messages>

	<layers>
		<layer>
			<gpu:layerFunction>
				<name>lti_random_move</name>
			</gpu:layerFunction>
			<gpu:layerFunction>
				<name>ltin_random_move</name>
			</gpu:layerFunction>
		</layer>
	</layers>

</gpu:xmodel>

